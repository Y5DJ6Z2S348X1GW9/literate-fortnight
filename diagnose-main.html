<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>ä¸»é¡µé¢è¯Šæ–­</title>
    <script>
        window.APP_CONFIG = { basePath: '/literate-fortnight' };
    </script>
    <base href="/literate-fortnight/">
    <style>
        body { font-family: monospace; padding: 20px; background: #f5f5f5; }
        .test { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; }
        .success { border-left: 4px solid #28a745; }
        .error { border-left: 4px solid #dc3545; }
        .warning { border-left: 4px solid #ffc107; }
        h1 { color: #333; }
        pre { background: #f8f8f8; padding: 10px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>ğŸ”¬ ä¸»é¡µé¢å®Œæ•´è¯Šæ–­</h1>
    <div id="results"></div>
    
    <div class="test">
        <h2>æ‰‹åŠ¨æµ‹è¯•</h2>
        <button onclick="testCSS()">æµ‹è¯•CSSåŠ è½½</button>
        <button onclick="testSDKs()">æµ‹è¯•SDKåŠ è½½</button>
        <button onclick="testApp()">æµ‹è¯•App.js</button>
        <button onclick="window.location.href='index.html'">æ‰“å¼€ä¸»é¡µé¢</button>
    </div>

    <script>
        const results = document.getElementById('results');
        
        function addTest(title, status, details) {
            const div = document.createElement('div');
            div.className = `test ${status}`;
            div.innerHTML = `<h2>${title}</h2><pre>${details}</pre>`;
            results.appendChild(div);
        }

        // Test 1: ç¯å¢ƒæ£€æŸ¥
        addTest('âœ… ç¯å¢ƒæ£€æŸ¥', 'success', `
URL: ${window.location.href}
Base: ${document.baseURI}
APP_CONFIG: ${JSON.stringify(window.APP_CONFIG, null, 2)}
        `);

        // Test 2: CSSåŠ è½½æµ‹è¯•
        function testCSS() {
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'styles/main.css';
            link.onload = () => {
                addTest('âœ… CSSåŠ è½½æˆåŠŸ', 'success', 'styles/main.css åŠ è½½å®Œæˆ');
                
                // æµ‹è¯•.hiddenç±»
                const testDiv = document.createElement('div');
                testDiv.className = 'hidden';
                testDiv.textContent = 'æµ‹è¯•';
                document.body.appendChild(testDiv);
                const isHidden = window.getComputedStyle(testDiv).display === 'none';
                document.body.removeChild(testDiv);
                
                addTest(isHidden ? 'âœ… .hiddenç±»å·¥ä½œæ­£å¸¸' : 'âŒ .hiddenç±»ä¸å·¥ä½œ', 
                    isHidden ? 'success' : 'error',
                    `display: ${window.getComputedStyle(testDiv).display}`
                );
            };
            link.onerror = () => {
                addTest('âŒ CSSåŠ è½½å¤±è´¥', 'error', 'styles/main.css åŠ è½½å¤±è´¥');
            };
            document.head.appendChild(link);
        }

        // Test 3: SDKåŠ è½½æµ‹è¯•
        function testSDKs() {
            // Test Pusher
            const pusher = document.createElement('script');
            pusher.src = 'https://js.pusher.com/8.2.0/pusher.min.js';
            pusher.onload = () => {
                addTest('âœ… Pusher SDKåŠ è½½æˆåŠŸ', 'success', 
                    `typeof Pusher: ${typeof Pusher}`
                );
            };
            pusher.onerror = () => {
                addTest('âŒ Pusher SDKåŠ è½½å¤±è´¥', 'error', 'æ— æ³•ä»CDNåŠ è½½Pusher');
            };
            document.head.appendChild(pusher);

            // Test Ably
            setTimeout(() => {
                const ably = document.createElement('script');
                ably.src = 'https://cdn.ably.com/lib/ably.min-1.js';
                ably.onload = () => {
                    addTest('âœ… Ably SDKåŠ è½½æˆåŠŸ', 'success', 
                        `typeof Ably: ${typeof Ably}`
                    );
                };
                ably.onerror = () => {
                    addTest('âŒ Ably SDKåŠ è½½å¤±è´¥', 'error', 'æ— æ³•ä»CDNåŠ è½½Ably');
                };
                document.head.appendChild(ably);
            }, 500);
        }

        // Test 4: App.jsåŠ è½½æµ‹è¯•
        async function testApp() {
            try {
                // å…ˆåŠ è½½æ‰€æœ‰ä¾èµ–
                const ConfigManager = await import('./js/config/ConfigManager.js');
                addTest('âœ… ConfigManageråŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const ConfigWizard = await import('./js/ui/ConfigWizard.js');
                addTest('âœ… ConfigWizardåŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const StorageManager = await import('./js/storage/StorageManager.js');
                addTest('âœ… StorageManageråŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const BrokerFactory = await import('./js/brokers/BrokerFactory.js');
                addTest('âœ… BrokerFactoryåŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const MessageManager = await import('./js/messaging/MessageManager.js');
                addTest('âœ… MessageManageråŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const ConnectionManager = await import('./js/messaging/ConnectionManager.js');
                addTest('âœ… ConnectionManageråŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                const UIController = await import('./js/ui/UIController.js');
                addTest('âœ… UIControlleråŠ è½½æˆåŠŸ', 'success', 'æ¨¡å—å¯¼å…¥æˆåŠŸ');
                
                addTest('âœ… æ‰€æœ‰æ¨¡å—åŠ è½½æˆåŠŸ', 'success', 'åº”ç”¨ç¨‹åºåº”è¯¥å¯ä»¥æ­£å¸¸è¿è¡Œ');
                
            } catch (error) {
                addTest('âŒ æ¨¡å—åŠ è½½å¤±è´¥', 'error', `
é”™è¯¯: ${error.message}
å †æ ˆ: ${error.stack}
                `);
            }
        }

        // è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        setTimeout(() => {
            testCSS();
            testSDKs();
        }, 500);
    </script>
</body>
</html>
