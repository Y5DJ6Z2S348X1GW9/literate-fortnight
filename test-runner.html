<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æµ‹è¯•è¿è¡Œå™¨ - è·¨è®¾å¤‡æ¶ˆæ¯ä¼ é€’</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #333;
            margin-bottom: 10px;
        }

        .header p {
            color: #666;
            line-height: 1.6;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .test-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .test-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .test-card h3 {
            color: #333;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .test-card p {
            color: #666;
            font-size: 14px;
            margin-bottom: 15px;
            line-height: 1.5;
        }

        .test-card button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: opacity 0.2s;
        }

        .test-card button:hover {
            opacity: 0.9;
        }

        .test-card button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .run-all-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            grid-column: 1 / -1;
        }

        .run-all-card h3,
        .run-all-card p {
            color: white;
        }

        .run-all-card button {
            background: white;
            color: #667eea;
        }

        .console-output {
            background: #1e1e1e;
            border-radius: 12px;
            padding: 20px;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 500px;
            overflow-y: auto;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .console-output:empty::before {
            content: 'ç­‰å¾…æµ‹è¯•è¿è¡Œ...';
            color: #666;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-pass {
            color: #4ade80;
        }

        .log-fail {
            color: #f87171;
        }

        .log-info {
            color: #60a5fa;
        }

        .log-warn {
            color: #fbbf24;
        }

        .log-summary {
            color: #a78bfa;
            font-weight: bold;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #333;
        }

        .status-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .status-ready {
            background: #4ade80;
            color: white;
        }

        .status-running {
            background: #fbbf24;
            color: white;
        }

        .status-error {
            background: #f87171;
            color: white;
        }

        .actions {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .actions button {
            flex: 1;
            padding: 12px 24px;
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .actions button:hover {
            background: #667eea;
            color: white;
        }

        .instructions {
            background: white;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .instructions h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .instructions ol {
            margin-left: 20px;
            color: #666;
            line-height: 1.8;
        }

        .instructions li {
            margin-bottom: 8px;
        }

        .instructions code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª è·¨è®¾å¤‡æ¶ˆæ¯ä¼ é€’ç³»ç»Ÿ - æµ‹è¯•è¿è¡Œå™¨</h1>
            <p>è¿™ä¸ªé¡µé¢æä¾›äº†ä¸€ä¸ªå¯è§†åŒ–ç•Œé¢æ¥è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®å¼€å§‹æµ‹è¯•ã€‚</p>
            <span id="status-badge" class="status-badge status-ready">å°±ç»ª</span>
        </div>

        <div class="instructions">
            <h2>ğŸ“‹ æµ‹è¯•å‰å‡†å¤‡</h2>
            <ol>
                <li>ç¡®ä¿åº”ç”¨å·²åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µä¸­æ‰“å¼€å¹¶å®Œæˆé…ç½®</li>
                <li>å¦‚æœè¦æµ‹è¯•è·¨è®¾å¤‡æ¶ˆæ¯ï¼Œè¯·åœ¨ä¸¤ä¸ªä¸åŒçš„çª—å£/è®¾å¤‡ä¸­æ‰“å¼€åº”ç”¨</li>
                <li>ç¡®ä¿ä¸¤ä¸ªè®¾å¤‡ä½¿ç”¨ç›¸åŒçš„é¢‘é“åç§°</li>
                <li>ç‚¹å‡»ä¸‹é¢çš„æµ‹è¯•æŒ‰é’®å¼€å§‹è‡ªåŠ¨åŒ–æµ‹è¯•</li>
                <li>æŸ¥çœ‹æ§åˆ¶å°è¾“å‡ºäº†è§£æµ‹è¯•ç»“æœ</li>
            </ol>
        </div>

        <div class="actions">
            <button onclick="openApp()">ğŸš€ æ‰“å¼€åº”ç”¨</button>
            <button onclick="clearConsole()">ğŸ—‘ï¸ æ¸…ç©ºæ§åˆ¶å°</button>
            <button onclick="openDevTools()">ğŸ”§ æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°</button>
        </div>

        <div class="test-grid">
            <div class="test-card run-all-card">
                <h3>ğŸ¯ è¿è¡Œæ‰€æœ‰æµ‹è¯•</h3>
                <p>æ‰§è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼ŒåŒ…æ‹¬ Ablyã€Pusherã€é‡è¿å’Œé€šçŸ¥åŠŸèƒ½æµ‹è¯•</p>
                <button onclick="runTest('all')">è¿è¡Œæ‰€æœ‰æµ‹è¯•</button>
            </div>

            <div class="test-card">
                <h3>ğŸ“¡ Ably æ¶ˆæ¯æµ‹è¯•</h3>
                <p>æµ‹è¯• Ably æœåŠ¡çš„æ¶ˆæ¯å‘é€ã€æ¥æ”¶å’Œå­˜å‚¨åŠŸèƒ½</p>
                <button onclick="runTest('ably')">è¿è¡Œæµ‹è¯•</button>
            </div>

            <div class="test-card">
                <h3>ğŸ“¡ Pusher æ¶ˆæ¯æµ‹è¯•</h3>
                <p>æµ‹è¯• Pusher æœåŠ¡åˆ‡æ¢å’Œæ¶ˆæ¯æ”¶å‘åŠŸèƒ½</p>
                <button onclick="runTest('pusher')">è¿è¡Œæµ‹è¯•</button>
            </div>

            <div class="test-card">
                <h3>ğŸ”„ é‡è¿æœºåˆ¶æµ‹è¯•</h3>
                <p>æµ‹è¯•ç½‘ç»œæ–­å¼€æ—¶çš„è‡ªåŠ¨é‡è¿åŠŸèƒ½</p>
                <button onclick="runTest('reconnection')">è¿è¡Œæµ‹è¯•</button>
            </div>

            <div class="test-card">
                <h3>ğŸ”” é€šçŸ¥åŠŸèƒ½æµ‹è¯•</h3>
                <p>æµ‹è¯•æ¡Œé¢é€šçŸ¥å’Œæ¨é€é€šçŸ¥åŠŸèƒ½</p>
                <button onclick="runTest('notifications')">è¿è¡Œæµ‹è¯•</button>
            </div>
        </div>

        <div class="console-output" id="console-output"></div>
    </div>

    <script>
        const consoleOutput = document.getElementById('console-output');
        const statusBadge = document.getElementById('status-badge');

        // Override console methods to capture output
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = message;
            consoleOutput.appendChild(entry);
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            
            if (message.includes('âœ… PASS')) {
                addLogEntry(message, 'pass');
            } else if (message.includes('âŒ FAIL')) {
                addLogEntry(message, 'fail');
            } else if (message.includes('TEST SUMMARY') || message.includes('=====')) {
                addLogEntry(message, 'summary');
            } else if (message.includes('âš ï¸') || message.includes('Warning')) {
                addLogEntry(message, 'warn');
            } else {
                addLogEntry(message, 'info');
            }
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addLogEntry(args.join(' '), 'fail');
        };

        console.warn = function(...args) {
            originalWarn.apply(console, args);
            addLogEntry(args.join(' '), 'warn');
        };

        function setStatus(status, text) {
            statusBadge.className = `status-badge status-${status}`;
            statusBadge.textContent = text;
        }

        async function runTest(testType) {
            setStatus('running', 'è¿è¡Œä¸­...');
            
            try {
                // Load test utilities if not already loaded
                if (typeof window.testAblyMessaging === 'undefined') {
                    addLogEntry('ğŸ“¦ åŠ è½½æµ‹è¯•å·¥å…·...', 'info');
                    await loadTestUtils();
                }

                addLogEntry(`\nğŸš€ å¼€å§‹ ${getTestName(testType)} æµ‹è¯•...\n`, 'info');

                switch(testType) {
                    case 'all':
                        await window.runAllTests();
                        break;
                    case 'ably':
                        await window.testAblyMessaging();
                        break;
                    case 'pusher':
                        await window.testPusherMessaging();
                        break;
                    case 'reconnection':
                        await window.testReconnection();
                        break;
                    case 'notifications':
                        await window.testNotifications();
                        break;
                }

                setStatus('ready', 'å®Œæˆ');
            } catch (error) {
                addLogEntry(`âŒ æµ‹è¯•æ‰§è¡Œå¤±è´¥: ${error.message}`, 'fail');
                setStatus('error', 'é”™è¯¯');
            }
        }

        function getTestName(testType) {
            const names = {
                'all': 'æ‰€æœ‰',
                'ably': 'Ably æ¶ˆæ¯',
                'pusher': 'Pusher æ¶ˆæ¯',
                'reconnection': 'é‡è¿æœºåˆ¶',
                'notifications': 'é€šçŸ¥åŠŸèƒ½'
            };
            return names[testType] || testType;
        }

        async function loadTestUtils() {
            return new Promise((resolve, reject) => {
                const script = document.createElement('script');
                script.src = 'js/test-utils.js';
                script.onload = () => {
                    addLogEntry('âœ… æµ‹è¯•å·¥å…·åŠ è½½æˆåŠŸ', 'pass');
                    resolve();
                };
                script.onerror = () => {
                    addLogEntry('âŒ æµ‹è¯•å·¥å…·åŠ è½½å¤±è´¥', 'fail');
                    reject(new Error('Failed to load test utilities'));
                };
                document.body.appendChild(script);
            });
        }

        function openApp() {
            window.open('index.html', '_blank');
            addLogEntry('ğŸ“± å·²åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€åº”ç”¨', 'info');
        }

        function clearConsole() {
            consoleOutput.innerHTML = '';
            addLogEntry('ğŸ—‘ï¸ æ§åˆ¶å°å·²æ¸…ç©º', 'info');
        }

        function openDevTools() {
            addLogEntry('ğŸ’¡ æç¤º: æŒ‰ F12 æˆ– Ctrl+Shift+J (Mac: Cmd+Option+J) æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·', 'info');
        }

        // Initial message
        addLogEntry('ğŸ‘‹ æ¬¢è¿ä½¿ç”¨æµ‹è¯•è¿è¡Œå™¨ï¼', 'info');
        addLogEntry('ğŸ“ è¯·å…ˆæ‰“å¼€åº”ç”¨å¹¶å®Œæˆé…ç½®ï¼Œç„¶åç‚¹å‡»ä¸Šæ–¹çš„æµ‹è¯•æŒ‰é’®', 'info');
    </script>
</body>
</html>
